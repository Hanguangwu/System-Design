<!DOCTYPE HTML>
<html lang="zh-cn" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>14-策略模式 - The Zen of Programming</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-4fa65084.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-df451732.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Zen of Programming</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h2 id="什么是策略模式"><a class="header" href="#什么是策略模式">什么是策略模式</a></h2>
<p><strong>策略模式</strong>（Strategy Pattern）是一种行为型设计模式。它的核心思想就是：<strong>定义一系列算法，把它们一个个封装起来，并且让它们可以互相替换</strong>。<br>换句话说，我们可以把不同的处理逻辑抽象成不同的策略对象，在程序运行时，根据实际情况动态选择合适的策略进行处理，而不需要在代码里堆砌大量的<code>if...else</code>或<code>switch</code>判断。</p>
<p>拿生活中的场景来说，这事其实我们每天都在干。比如我们早上出门上班时，会根据天气和路况选择出行方式：天气好就骑车，下雨就打车，堵车就改坐地铁。不同的出行方式就是不同的策略，鱼皮根据实际情况灵活选择，背后逻辑就非常符合策略模式的设计理念。</p>
<p><img src="./img/88.png" alt=""></p>
<p>这种模式在项目里非常好用，尤其是当你发现代码里出现了很多重复的判断逻辑，或者某个行为有多个实现方式的时候，基本可以考虑用策略模式重构一波。它能帮你把变化隔离开来，让程序更灵活、更可维护。</p>
<h2 id="为什么要使用策略模式"><a class="header" href="#为什么要使用策略模式">为什么要使用策略模式？</a></h2>
<p>在实际开发中，当我们遇到需要根据不同条件选择不同行为的场景时，最直接的做法通常是堆一堆<code>if-else</code>或者<code>switch-case</code>判断。随着条件的增多，代码就会变得又长又乱，维护起来非常困难。更重要的是，这种做法严重违背了面向对象设计的开闭原则（对扩展开放，对修改关闭）。<br>而使用策略模式，我们可以把每一种策略独立封装成单独的类，后续如果要新增、修改策略，只需要扩展新的策略类就行，原有代码不需要改动，系统的扩展性和可维护性就能大大提升。</p>
<p>为了让大家更好地感受到策略模式的作用，以电商折扣计算为例，我们需要实现一个灵活的促销系统，支持多种折扣方式。让我们来看看使用和不使用策略模式的区别：</p>
<p><img src="./img/89.png" alt=""></p>
<p>通过对比可以看出，不使用策略模式时，所有的折扣计算逻辑都集中在<code>PriceCalculator</code>类中，使用 if 语句进行判断。这种方式导致代码耦合度高且维护困难，每当需要添加新的折扣方式时，都需要修改<code>PriceCalculator</code>类的代码，违反了开闭原则。</p>
<p>而使用策略模式后，我们将每种折扣方式封装成独立的策略类，通过接口统一管理。<code>PriceCalculator</code>类不再关心具体的折扣计算逻辑，只需要调用策略对象的calculate方法即可。这种设计使得系统更加灵活，添加新的折扣方式只需要创建新的策略类，无需修改现有代码。同时，策略模式也使得代码结构更加清晰，每个策略类都专注于自己的职责，提高了代码的可维护性。</p>
<h2 id="策略模式的应用场景"><a class="header" href="#策略模式的应用场景">策略模式的应用场景</a></h2>
<p>举一些开发中典型的应用场景：</p>
<ul>
<li>支付系统中的支付方式选择：在电商平台中，支付系统通常支持多种支付方式（如支付宝、微信支付、信用卡等）。通过策略模式，可以将每种支付方式抽象为不同的策略类，用户根据选择的支付方式动态切换对应的策略，简化支付流程的实现和扩展。</li>
<li>折扣计算策略：在电商平台或购物网站中，商品的折扣计算可能根据不同的促销策略（如满减、打折、会员折扣等）有所不同。策略模式允许根据不同的促销活动或用户等级选择相应的折扣策略，并在需要时轻松切换或扩展折扣规则。</li>
<li>路线规划算法：在导航系统或地图应用中，用户可以选择不同的路线规划算法（如最短路径、最快路径、避免拥堵等）。策略模式可以将这些不同的路线规划策略封装为不同的算法策略，用户选择时可以动态切换算法，无需修改系统的核心逻辑。</li>
<li>日志记录方式选择：在应用中，日志的记录方式可能根据不同的环境或需求而变化。例如，在开发环境中可以记录详细日志，而在生产环境中可能只记录关键日志。通过策略模式，可以在程序运行时选择不同的日志记录策略（如控制台输出、文件写入、远程日志服务等）。</li>
</ul>
<h2 id="策略模式的基本结构"><a class="header" href="#策略模式的基本结构">策略模式的基本结构</a></h2>
<p>策略模式具有的角色和职责：</p>
<p>1）策略接口（Strategy）：定义所有支持的算法（策略）必须实现的方法。</p>
<p>2）具体策略（ConcreteStrategy）：实现策略接口，封装具体的算法实现。</p>
<p>3）上下文（Context）：持有一个策略接口的引用，负责在客户端选择并执行具体的策略。</p>
<p>下面用一张类图帮大家更直观地理解策略模式的结构：</p>
<p><img src="./img/90.png" alt=""></p>
<h2 id="策略模式的实现"><a class="header" href="#策略模式的实现">策略模式的实现</a></h2>
<p>下面就以 “电商折扣计算” 为例，我们用策略模式实现一个灵活的促销系统。</p>
<p>1）定义折扣策略接口：声明统一的折扣计算方法</p>
<pre><code class="language-java">public interface DiscountStrategy {
    double calculate(double originalPrice);
}
</code></pre>
<p>这一步是策略模式的核心接口，抽象了“折扣”行为。所有促销方式只要实现这个接口，就能被系统自由替换调用。</p>
<p>2）实现具体策略类：满减、打折、会员折扣等</p>
<pre><code class="language-java">public class FullReductionStrategy implements DiscountStrategy {
    @Override
    public double calculate(double originalPrice) {
        if (originalPrice &gt;= 100) {
            return originalPrice - 20; // 满减
        }
        return originalPrice;
    }
}
</code></pre>
<pre><code class="language-java">public class PercentageDiscountStrategy implements DiscountStrategy {
    @Override
    public double calculate(double originalPrice) {
        return originalPrice * 0.9; // 打九折
    }
}
</code></pre>
<pre><code class="language-java">public class VipDiscountStrategy implements DiscountStrategy {
    @Override
    public double calculate(double originalPrice) {
        return originalPrice * 0.8; // VIP 打八折
    }
}
</code></pre>
<p>这些类就是“策略族”的具体实现，分别封装了不同的折扣规则。每种规则彼此独立，互不影响。</p>
<p>3）创建上下文类：接收策略并执行计算的业务入口</p>
<pre><code class="language-java">public class PriceCalculator {
    private DiscountStrategy strategy;

    public void setStrategy(DiscountStrategy strategy) {
        this.strategy = strategy;
    }

    public double calculatePrice(double originalPrice) {
        if (strategy == null) {
            throw new IllegalStateException("未设置折扣策略");
        }
        return strategy.calculate(originalPrice);
    }
}
</code></pre>
<p>上下文类 <code>PriceCalculator</code> 用于管理和执行折扣策略的调用逻辑。通过 <code>setStrategy()</code> 注入不同的策略对象，达到行为灵活切换的效果。</p>
<p>4）客户端调用示例</p>
<pre><code class="language-java">public class Client {
    public static void main(String[] args) {
        PriceCalculator calculator = new PriceCalculator();
        double originalPrice = 120.0;

        // 使用满减策略
        calculator.setStrategy(new FullReductionStrategy());
        System.out.println("【满减策略】最终价格：" + calculator.calculatePrice(originalPrice));

        // 使用打折策略
        calculator.setStrategy(new PercentageDiscountStrategy());
        System.out.println("【打折策略】最终价格：" + calculator.calculatePrice(originalPrice));

        // 使用 VIP 策略
        calculator.setStrategy(new VipDiscountStrategy());
        System.out.println("【VIP策略】最终价格：" + calculator.calculatePrice(originalPrice));
    }
}
</code></pre>
<p>输出结果：</p>
<pre><code class="language-plain">【满减策略】最终价格：100.0
【打折策略】最终价格：108.0
【VIP策略】最终价格：96.0
</code></pre>
<p>通过策略模式，<code>PriceCalculator</code> 并不关心折扣如何计算，只关心“调用策略”。这让我们在新增“新人专属满200减50”这类促销时，只需要实现一个新策略类，而无需改动旧逻辑。</p>
<h2 id="策略模式的优缺点"><a class="header" href="#策略模式的优缺点">策略模式的优缺点</a></h2>
<h3 id="优点"><a class="header" href="#优点">优点</a></h3>
<ul>
<li><strong>算法封装</strong>：策略模式将不同的算法封装成独立的策略类，每个策略类都实现一个统一的接口。这样，当我们需要切换算法时，只需要改变策略对象，而不需要修改客户端代码，增强了代码的灵活性和可维护性。</li>
<li><strong>符合开闭原则</strong>：当需要新增不同的策略时，我们只需增加新的策略类，并实现相应的算法，不需要修改原有的代码。这样，系统在需求变化时具有更好的扩展性。</li>
<li><strong>避免了多重条件判断</strong>：策略模式通过将复杂的条件判断逻辑分散到各个策略类中，避免了在主程序中出现大量的 if-else 或 switch-case 语句，使得代码更加清晰简洁，便于维护。</li>
</ul>
<h3 id="缺点"><a class="header" href="#缺点">缺点</a></h3>
<ul>
<li><strong>策略类过多</strong>：每增加一种策略，都需要创建一个新的策略类，随着策略数目的增加，系统中的类会变得比较多，可能导致代码冗长和难以管理。</li>
<li><strong>客户端必须了解策略</strong>：虽然策略模式让算法封装得很好，但客户端仍然需要了解不同策略之间的区别，并选择合适的策略。这可能会导致客户端变得有些复杂。</li>
<li><strong>增加了对象之间的协作</strong>：策略模式引入了一个上下文类来管理策略的切换和使用，这意味着客户端不仅需要选择策略，还需要与上下文进行协作，可能会引入额外的复杂度。</li>
</ul>
<h2 id="扩展知识---源码分析"><a class="header" href="#扩展知识---源码分析">扩展知识 - 源码分析</a></h2>
<h3 id="开源框架中的应用"><a class="header" href="#开源框架中的应用">开源框架中的应用</a></h3>
<h4 id="1spring-框架"><a class="header" href="#1spring-框架">1、Spring 框架</a></h4>
<p>Spring 里对策略模式的应用非常广泛，尤其是在处理一些“多种行为可选”的场景时，几乎都可以看到策略模式的场景。我们来看几个例子：</p>
<h5 id="orgspringframeworkbeansfactorysupportinstantiationstrategy"><a class="header" href="#orgspringframeworkbeansfactorysupportinstantiationstrategy">org.springframework.beans.factory.support.InstantiationStrategy：</a></h5>
<p>这个接口定义了 Bean 的实例化策略，不同策略实现了不同的实例化方式。</p>
<pre><code class="language-java">public interface InstantiationStrategy {
    // 实例化指定的 Bean
   	Object instantiate(RootBeanDefinition bd, @Nullable String beanName, BeanFactory owner)
			throws BeansException;
}

</code></pre>
<p>Spring 默认提供了两种实现：</p>
<ul>
<li><code>CglibSubclassingInstantiationStrategy</code>：使用 CGLIB 动态生成子类进行实例化</li>
<li><code>SimpleInstantiationStrategy</code>：使用默认构造函数或反射直接实例化</li>
</ul>
<p>具体调用是在 <code>AbstractAutowireCapableBeanFactory</code> 中进行的：</p>
<pre><code class="language-java">Object bean = getInstantiationStrategy().instantiate(bd, null, this);
</code></pre>
<p>我们可以根据配置或者条件，动态切换不同的实例化策略。</p>
<h5 id="orgspringframeworkcoreannotationmergedannotationssearchstrategy"><a class="header" href="#orgspringframeworkcoreannotationmergedannotationssearchstrategy">org.springframework.core.annotation.MergedAnnotations.SearchStrategy：</a></h5>
<p>这个枚举类定义了查找注解时的不同策略，比如：</p>
<ul>
<li><code>DIRECT</code>：只查找当前元素上的注解</li>
<li><code>INHERITED_ANNOTATIONS</code>：包括继承的注解</li>
<li><code>SUPERCLASS</code>：在父类中继续查找</li>
<li><code>TYPE_HIERARCHY</code>：在整个类型体系中查找</li>
</ul>
<p>这些枚举值就代表了不同的“搜索策略”，最终在 MergedAnnotations 的查找逻辑中，会根据这个策略来决定怎么找注解。</p>
<h5 id="orgspringframeworkbootautoconfigureconditionsearchstrategy"><a class="header" href="#orgspringframeworkbootautoconfigureconditionsearchstrategy">org.springframework.boot.autoconfigure.condition.SearchStrategy：</a></h5>
<p>在 Spring Boot 的条件装配机制中，也定义了一套策略枚举，用于控制 Bean 的搜索范围，比如：</p>
<ul>
<li><code>ALL</code>：在全局范围查找</li>
<li><code>CURRENT</code>：只在当前上下文中查找</li>
</ul>
<p>这些也是典型的策略枚举，允许我们根据场景动态控制 Bean 的获取逻辑。</p>
<h3 id="优势和作用"><a class="header" href="#优势和作用">优势和作用</a></h3>
<p>通过上述的源码分析，我们可以再次总结下策略模式的作用。</p>
<h4 id="1让行为扩展更加灵活"><a class="header" href="#1让行为扩展更加灵活">1、让行为扩展更加灵活</a></h4>
<p>策略模式把行为封装到独立的策略类中，我们只需要新增一个策略实现类，就可以扩展出新的行为，不需要修改已有的逻辑。这种“扩展开放、修改关闭”的设计原则非常有利于维护大型系统。</p>
<h4 id="2避免复杂的-ifelse-或-switch-逻辑"><a class="header" href="#2避免复杂的-ifelse-或-switch-逻辑">2、避免复杂的 if/else 或 switch 逻辑</a></h4>
<p>在实际开发中，我们经常会看到一堆基于类型、状态的 if/else 分支判断。使用策略模式后，这些判断可以转化为策略选择，结构更清晰，职责更单一，逻辑更容易管理。</p>
<h4 id="3提高代码复用率和可测试性"><a class="header" href="#3提高代码复用率和可测试性">3、提高代码复用率和可测试性</a></h4>
<p>每个策略类职责单一，独立实现，可以单独测试，代码复用度也更高。在 Spring 中，我们可以将不同策略注册为不同的 Bean，根据注入条件灵活切换，配合注解或配置使用非常方便。</p>
<h2 id="相关项目"><a class="header" href="#相关项目">相关项目</a></h2>
<h4 id="编程导航的-ai-答题平台项目"><a class="header" href="#编程导航的-ai-答题平台项目">编程导航的 AI 答题平台项目</a></h4>
<p>在 <a href="https://www.codefather.cn/course/1790274408835506178">编程导航的 AI 答题平台项目</a> 的判题评分模块中，使用了策略模式来封装不同的评分算法。由于业务场景中需要支持多种评分方式，不同的评分算法对应不同的处理策略，因此通过统一接口进行抽象，提升了系统的可扩展性和可维护性。</p>
<p>具体实现上，定义了 <code>ScoringStrategy</code> 接口，用于规范评分方法的入参和出参。每个评分算法实现该接口，并使用自定义注解 <code>ScoringStrategyConfig</code> 标识其对应的应用类型和评分类型。评分驱动类 <code>ScoringStrategyExecutor</code> 通过 Spring 注入所有实现类，执行时遍历评分策略列表，并结合注解中的元信息筛选出匹配的算法并调用其实现，从而实现评分逻辑的灵活调度。</p>
<p><img src="./img/91.png" alt=""></p>
<h4 id="编程导航的-oj-判题项目"><a class="header" href="#编程导航的-oj-判题项目">编程导航的 OJ 判题项目</a></h4>
<p>在 <a href="https://www.codefather.cn/course/1790980707917017089">编程导航的 OJ 判题项目 </a>的判题模块中，为了解决不同编程语言对应的判题逻辑差异问题，使用了策略模式。由于各语言的判题规则存在差异（例如 Java 语言可能需要更高的时间和内存限制），如果直接在业务层通过大量 <code>if-else</code> 语句进行区分，会导致代码的圈复杂度上升，不利于维护。</p>
<p>为此，系统定义了 <code>JudgeStrategy</code> 接口，统一约定了 <code>doJudge</code> 方法，不同语言的判题逻辑通过实现该接口的策略类进行封装，例如 <code>JavaLanguageJudgeStrategy</code>。当需要调整某种语言的判题逻辑时，只需修改对应的策略类即可，增强了系统的可扩展性和可维护性。同时引入了 <code>JudgeContext</code> 类，用于封装策略执行过程中所需的上下文信息，并通过 <code>JudgeManager</code> 类根据具体编程语言选择对应策略并执行，从而实现了判题逻辑的模块化管理，简化了 service 层的代码结构。</p>
<p><img src="./img/92.png" alt=""></p>
<h2 id="相关面试题"><a class="header" href="#相关面试题">相关面试题</a></h2>
<p>可以在 <a href="https://www.mianshiya.com/">程序员面试刷题神器 - 面试鸭</a> 上获取到企业常问的设计模式面试题。比如：</p>
<p>1）<a href="https://www.mianshiya.com/bank/1801559627969929217/question/1803305303140720641">什么是策略模式？一般用在什么场景？ </a></p>
<p><img src="./img/93.png" alt=""></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../DesignPattern/行为型模式.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../DesignPattern/15-命令模式.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../DesignPattern/行为型模式.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../DesignPattern/15-命令模式.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
